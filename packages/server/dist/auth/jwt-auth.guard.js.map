{"version":3,"sources":["../../src/auth/jwt-auth.guard.ts"],"sourcesContent":["import { Injectable, ExecutionContext, UnauthorizedException } from '@nestjs/common';\nimport { AuthGuard } from '@nestjs/passport';\nimport { JwtService } from '@nestjs/jwt';\n\n@Injectable()\nexport class JwtAuthGuard extends AuthGuard('jwt') {\n  constructor(private readonly jwtService: JwtService) {\n    super();\n  }\n\n  canActivate(context: ExecutionContext) {\n    const request = context.switchToHttp().getRequest();\n    const authHeader = request.headers.authorization;\n\n    // JWT ÌÜ†ÌÅ∞ Ï†ïÎ≥¥ Î°úÍπÖ\n    if (authHeader && authHeader.startsWith('Bearer ')) {\n      try {\n        const token = authHeader.substring(7);\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        const decoded = this.jwtService.verify(token) as any;\n\n        console.log('üîê JWT ÌÜ†ÌÅ∞ ÎîîÏΩîÎî© Ï†ïÎ≥¥:', {\n          userId: decoded.userId,\n          provider: decoded.provider,\n          issuedAt: new Date(decoded.iat * 1000).toISOString(),\n          expiresAt: new Date(decoded.exp * 1000).toISOString(),\n          remainingTime: Math.floor((decoded.exp * 1000 - Date.now()) / 1000 / 60), // Î∂Ñ Îã®ÏúÑ\n        });\n\n        // ÏöîÏ≤≠ Í∞ùÏ≤¥Ïóê ÌÜ†ÌÅ∞ Ï†ïÎ≥¥ Ï∂îÍ∞Ä\n        request.tokenInfo = {\n          userId: decoded.userId,\n          provider: decoded.provider,\n          issuedAt: decoded.iat,\n          expiresAt: decoded.exp,\n        };\n      } catch (error) {\n        console.log('‚ö†Ô∏è JWT ÌÜ†ÌÅ∞ ÎîîÏΩîÎî© Ïã§Ìå®:', error instanceof Error ? error.message : String(error));\n      }\n    }\n\n    return super.canActivate(context);\n  }\n\n  handleRequest(err: any, user: any, info: any) {\n    if (err || !user) {\n      throw err || new UnauthorizedException('Ïù∏Ï¶ùÏù¥ ÌïÑÏöîÌï©ÎãàÎã§.');\n    }\n    return user;\n  }\n}\n\n\n\n"],"names":["JwtAuthGuard","AuthGuard","canActivate","context","request","switchToHttp","getRequest","authHeader","headers","authorization","startsWith","token","substring","decoded","jwtService","verify","console","log","userId","provider","issuedAt","Date","iat","toISOString","expiresAt","exp","remainingTime","Math","floor","now","tokenInfo","error","Error","message","String","handleRequest","err","user","info","UnauthorizedException"],"mappings":";;;;+BAKaA;;;eAAAA;;;wBALuD;0BAC1C;qBACC;;;;;;;;;;AAGpB,IAAA,AAAMA,eAAN,MAAMA,qBAAqBC,IAAAA,mBAAS,EAAC;IAK1CC,YAAYC,OAAyB,EAAE;QACrC,MAAMC,UAAUD,QAAQE,YAAY,GAAGC,UAAU;QACjD,MAAMC,aAAaH,QAAQI,OAAO,CAACC,aAAa;QAEhD,eAAe;QACf,IAAIF,cAAcA,WAAWG,UAAU,CAAC,YAAY;YAClD,IAAI;gBACF,MAAMC,QAAQJ,WAAWK,SAAS,CAAC;gBACnC,8DAA8D;gBAC9D,MAAMC,UAAU,IAAI,CAACC,UAAU,CAACC,MAAM,CAACJ;gBAEvCK,QAAQC,GAAG,CAAC,qBAAqB;oBAC/BC,QAAQL,QAAQK,MAAM;oBACtBC,UAAUN,QAAQM,QAAQ;oBAC1BC,UAAU,IAAIC,KAAKR,QAAQS,GAAG,GAAG,MAAMC,WAAW;oBAClDC,WAAW,IAAIH,KAAKR,QAAQY,GAAG,GAAG,MAAMF,WAAW;oBACnDG,eAAeC,KAAKC,KAAK,CAAC,AAACf,CAAAA,QAAQY,GAAG,GAAG,OAAOJ,KAAKQ,GAAG,EAAC,IAAK,OAAO;gBACvE;gBAEA,kBAAkB;gBAClBzB,QAAQ0B,SAAS,GAAG;oBAClBZ,QAAQL,QAAQK,MAAM;oBACtBC,UAAUN,QAAQM,QAAQ;oBAC1BC,UAAUP,QAAQS,GAAG;oBACrBE,WAAWX,QAAQY,GAAG;gBACxB;YACF,EAAE,OAAOM,OAAO;gBACdf,QAAQC,GAAG,CAAC,qBAAqBc,iBAAiBC,QAAQD,MAAME,OAAO,GAAGC,OAAOH;YACnF;QACF;QAEA,OAAO,KAAK,CAAC7B,YAAYC;IAC3B;IAEAgC,cAAcC,GAAQ,EAAEC,IAAS,EAAEC,IAAS,EAAE;QAC5C,IAAIF,OAAO,CAACC,MAAM;YAChB,MAAMD,OAAO,IAAIG,6BAAqB,CAAC;QACzC;QACA,OAAOF;IACT;IA3CA,YAAY,AAAiBvB,UAAsB,CAAE;QACnD,KAAK,SADsBA,aAAAA;IAE7B;AA0CF"}